local plugin_label = 'batmobile'
-- kept plugin label instead of waiting for update_tracker to set it
local navigator = require 'core.navigator'
local explorer = require 'core.explorer'
local tracker = require 'core.tracker'
local utils = require 'core.utils'

local external = {
    name          = plugin_label
}
external.is_done = function ()
    return navigator.is_done()
end
external.is_paused = function ()
    return navigator.paused
end
external.pause = function (caller)
    if caller == nil then
        utils.log(2,'pause called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'pause called by ' .. tostring(caller))
    navigator.pause()
end
external.resume = function (caller)
    if caller == nil then
        utils.log(2,'resume called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'resume called by ' .. tostring(caller))
    navigator.unpause()
end
external.reset = function (caller)
    if caller == nil then
        utils.log(2,'reset called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'reset called by ' .. tostring(caller))
    navigator.reset()
end
external.move = function (caller)
    if caller == nil then
        utils.log(2,'move called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'move called by ' .. tostring(caller))
    local start_move = os.clock()
    navigator.move()
    tracker.timer_move = os.clock() - start_move
end
external.update = function (caller)
    if caller == nil then
        utils.log(2,'update called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'update called by ' .. tostring(caller))
    local start_update = os.clock()
    navigator.update()
    tracker.timer_update = os.clock() - start_update
end
external.set_target = function(caller, target, disable_spell)
    if caller == nil then
        utils.log(2,'set_target called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'set_target called by ' .. tostring(caller))
    navigator.set_target(target, disable_spell)
end
external.clear_target = function (caller)
    if caller == nil then
        utils.log(2,'clear_target called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'clear_target called by ' .. tostring(caller))
    navigator.clear_target()
end
external.get_backtrack = function(caller)
    if caller == nil then
        utils.log(2,'get_backtrack called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'get_backtrack called by ' .. tostring(caller))
    return explorer.backtrack
end
external.set_priority = function(caller, priority)
    if caller == nil then
        utils.log(2,'set_priority called with no caller')
        return
    end
    tracker.external_caller = caller
    utils.log(2, 'set_priority called by ' .. tostring(caller) .. ' to priortize ' .. tostring(priority))
    explorer.set_priority(priority)
end

return external